# 要件定義

## 1. アプリケーション概要

- **名称:** 仕事サポートアプリ
- **種別:** Webアプリケーション

## 2. 目的

日々の工数記録を効率化する機能に加え、ミッション管理、目標管理など、日々の業務を多角的に補助する機能を提供する。将来的には更なる機能拡張も視野に入れ、幅広い仕事のサポートを目指す。

## 3. 機能要件

### 3.1. 工数入力機能

- Googleフォームの単一のテキストエリアに、所定の書式で案件ごとのタスク情報をまとめて入力する。
- 入力テキストは、案件、タスク、見積工数、実績工数を含んだ構造的なデータとする。
- フォームから送信されたデータは、バックエンドで解析され、データベースに保存される。
- Web UIから送信されるJSONペイロードを受け付け、日付と「案件・タスク・見積工数・実績工数」の配列を構造化されたまま保存するAPIを提供する。ユーザー設定で通知が有効な場合（デフォルトは有効）、登録完了後にユーザーへ完了メールを送信する。
  - 件名は「工数を登録しました」とし、本文には登録日、各工数エントリ（案件・タスク・見積・実績）、メモ、および集計情報を含める。

### 3.2. ミッション管理機能

- Web UIを介してミッション（業務目標やタスクとは別の中長期的な指針）を登録・更新できる。

### 3.3. 目標管理機能

- Web UIを介して、目標を登録・更新できる。
- 画面での表示・操作対象は、**`end_date`が最も未来日に設定されている期間の目標群**のみとする。
- 各目標は以下の要素で構成される。
  - 期間（開始日・終了日）
  - 目標（タイトル）
  - 内容（詳細記述）
  - ウェイト（重要度）
  - 進捗率
- 期間は作成時に確定し、以降は更新できない。UIからも変更不可とする。
- 現在の目標一覧では、テーブル上から目標（タイトル）、ウェイト、進捗率を更新できる更新ボタンを提供し、同時に内容は詳細ダイアログから更新できるようにする。
- ウェイトの合計が100%になっていない場合は更新ボタンを非活性化する。
- 目標削除時は確認ダイアログで目標名の再入力を求め、入力が一致した場合のみ削除操作を有効化する。

### 3.4. 週報出力機能

UI上のDatePickerで選択された日付に基づき、週報の対象となる期間を決定し、以下のレポートを出力する。

#### 3.4.1. 対象期間の定義
- 週の始まりは月曜日とする。
- レポートの対象は、選択された日付が属する週の**月曜日から金曜日まで**の5日間とする。
- （例: 2025/09/28(日) を選択した場合、対象期間は 2025/09/22(月)〜09/26(金) となる）

#### 3.4.2. ミッション出力

- Web UIで登録・更新された最新のミッション情報を整形して出力する。

#### 3.4.3. 業務状況レポート出力

- **工数サマリー:**
    - 上記で定義された対象期間内の工数データを基に、日別および案件別の業務状況を生成する。
- **目標進捗サマリー:**
    - 保存されている目標の進捗状況をレポートに含めて出力する。

### 3.5. 外部連携機能
- Googleフォームからの工数データを受け付けるためのAPIエンドポイントを提供する。
- この連携は、システムで管理される単一のAPIキーを用いて認証される。

### 3.6. 工数入力ドラフト保存機能

- 工数入力画面での作業内容（案件、タスク、工数、メモなど）を送信前に一時保存する。
- 入力内容が変更される度にドラフト保存APIを呼び出し、ユーザー単位で最新の入力状態を保持する。
- 工数が正式に送信され成功した場合は、ドラフトに保存された同一ユーザーのデータを削除する。
- 保存されたドラフトは専用の取得APIで復元できるようにする。
- 連続した保存要求が発生した場合でも、最新のドラフトのみが保持されるように時刻情報を使った整合性制御を行う。
- 工数入力画面遷移時に案件取得API、タスク取得API、工数ドラフト取得APIを呼び出し、取得できたドラフト内容を初期表示する。案件／タスクの候補は取得結果をコンボボックスに表示する。

### 3.7. 目標履歴・進捗取得機能

- 前週末までの最新進捗率を取得するAPIを提供し、各目標の直近進捗を参照できるようにする。
- 過去の目標を検索するAPIを提供し、検索条件、並び順、ページ、ページサイズを指定して取得できるようにする。
  - 検索条件には期間、キーワード、進捗率（最小・最大）を含める。
- 過去目標検索に使用した検索条件および並び替え条件はローカルストレージに保存し、画面再表示時には保存済みの条件を自動適用したうえで検索を実行する。
- 目標の新規追加時には、以下の警告と制約を適用する。
  - 保存後に期間が更新できないことをダイアログで通知する。
  - 既存の目標が編集不可になることを通知する。
  - 既存の目標よりも未来の期間でなければ保存できない。

### 3.8. マスターデータ取得機能

- ログインユーザーに紐づく案件の一覧を取得するAPIを提供する。
- ログインユーザーに紐づくタスクの一覧を取得するAPIを提供する。

### 3.9. ユーザー設定管理機能

- 新規ユーザー作成後に、通知設定（デフォルトで有効）を含むユーザー設定レコードを作成するAPIを提供する。
- ユーザー設定は工数登録完了メールなどの通知可否を制御する。

## 4. 非機能要件

### 4.1. UI/UX
- PCおよびスマートフォンからの利用を想定し、レスポンシブデザインを採用する。

### 4.2. セキュリティ
- アプリケーションの利用にはユーザー認証（ログイン）を必須とする。
- Google Apps Scriptからのデータ連携は、システムで管理される固定APIキーを用いてリクエスト元を認証する。

### 4.3. エラーハンドリング
- アプリケーションで発生したエラーは、エラーログとしてデータベースの専用テーブルに記録する。
- クリティカルなエラーが発生した場合は、開発者へメールで通知する。

## 5. データモデル
- 「案件」は複数の「タスク」を持つことができる。
- 「工数」は各「タスク」に紐づく。

## 6. ユーザー管理
- ユーザーは自身のデータのみ閲覧・編集が可能で、他のユーザーのデータにはアクセスできない。
- 現時点では、管理者権限のような特別な役割は設けない。

## 7. その他

- （今後定義）

## 8. 出力サンプル

### 8.1. ミッション出力サンプル

```
■メンバー管理

■受託開発・社内開発の推進
案件マッチングツールのデモ運用実施中
新たに営業から10個の要望をいただいたため、
引き続き新機能の実装・改修等を進めていきます
```

### 8.2. 業務状況レポート出力サンプル

```

<日別業務状況>
09/15(月)：在宅 0h
09/16(火)：在宅 11h
09/17(水)：在宅 10h
09/18(木)：在宅 8.5h
09/19(金)：在宅 8h
平均：9.4h/日
合計：37.5h


<案件別業務状況>
■EntraID高速連携ツール（合計：34h）
>・打ち合わせ：5.75h
>・メール通知機能実装：18.5h
>・単体試験表作成：6.75h
>・単体試験：0.25h
>・検証：1h
>・インストーラー作成：0.5h
>・試験：1.25h


■その他（合計：3.5h）
>・タスク管理：0.5h
>・打ち合わせ：0.75h
>・雑務：0.25h
>・週報：0.5h
>・勤怠システム関連：1.5h


<学習状況(Udemy)>
■
>進捗率：% (+%)


<目標進捗状況>
=============================
全体
>進捗率：95.1%[285.2/300](+1.7%)
>加重達成率：89.6%[59.6,20,10](+3.6%)
>期待値：96.1% (↓6.5%)
=============================


■メイン：Udemyで20本のコースを受講し修了する[70]
>進捗率：85.2%(+5.2%)

■サブ①：仕事サポートアプリの改修[20]
>進捗率：100%【達成】

■サブ②：外部研修を5本受講する[10]
>進捗率：100%【達成】
```
